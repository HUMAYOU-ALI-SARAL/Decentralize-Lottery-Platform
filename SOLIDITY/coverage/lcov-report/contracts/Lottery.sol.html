<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Lottery.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Lottery.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">29.17% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>7/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">33.33% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>2/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">46.15% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>6/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">38.46% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>15/39</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: SEE LICENSE IN LICENSE
pragma solidity ^0.8.18;
import "@chainlink/contracts/src/v0.8/interfaces/VRFCoordinatorV2Interface.sol";
import "@chainlink/contracts/src/v0.8/vrf/VRFConsumerBaseV2.sol";
import "@chainlink/contracts/src/v0.8/automation/AutomationCompatible.sol";
&nbsp;
&nbsp;
error LowAmount();
error tranferFailed();
error invalidTimeInterval();
error  insufficientPlayers();
error insufficientFunds();
error lotteryUpkeepNotNeeded(uint currentbalance,uint players,uint lotteryState);
contract Lottery is VRFConsumerBaseV2,AutomationCompatibleInterface{
   //events
   //participant entered
   event participantEntered(address indexed);
   event requestLotteryWinner(uint indexed requestId);
   event WinnerPicked(address);
    // State Variables
    uint private immutable i_entryFee;
    bytes32 private immutable i_gasLane;
    uint64 private immutable i_subcriptionId;
    uint16 requestConfirmations = 3;
    uint32 private immutable i_callbackGasLimit;
    uint32 private NUM_Words=1;
    address payable[] private players;
    VRFCoordinatorV2Interface private immutable i_vrfCoordinatorInterface;
    uint private lastTimeStamp;
    // Lottery Variables
    address payable public s_recentWinner;
&nbsp;
&nbsp;
    // @forChainlinkKeepers
    uint private s_setInterval;
&nbsp;
&nbsp;
    // LotteryState
    enum LotteryState{
        Open,
        Pending,
        Close
    }
   LotteryState private stateLottery;
    constructor(uint _entryFee,address vrfCoordinator,bytes32 gasLane,uint64 subscriptionId,uint32 callbackGasLimit,uint setInterval) VRFConsumerBaseV2(vrfCoordinator){
        i_entryFee=_entryFee;
        i_vrfCoordinatorInterface=VRFCoordinatorV2Interface(vrfCoordinator);
        i_gasLane=gasLane;
        i_callbackGasLimit=callbackGasLimit;
        i_subcriptionId=subscriptionId;
        s_setInterval=setInterval;
        stateLottery=LotteryState(0);
    }
    
<span class="fstat-no" title="function not covered" >    function performUpkeep(bytes memory /*performdata*/)external override{</span>
<span class="cstat-no" title="statement not covered" >        (bool upkeepNeeded,)=checkUpkeep("");</span>
<span class="cstat-no" title="statement not covered" >        if(!upkeepNeeded){</span>
            revert lotteryUpkeepNotNeeded(address(this).balance,players.length,uint(stateLottery));
        }
<span class="cstat-no" title="statement not covered" >       uint requestId= i_vrfCoordinatorInterface.requestRandomWords(</span>
        i_gasLane,
        i_subcriptionId,
        requestConfirmations,
        i_callbackGasLimit,
        NUM_Words
       );
<span class="cstat-no" title="statement not covered" >       emit requestLotteryWinner(requestId);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function fulfillRandomWords(</span>
    uint256,
    uint[] memory randomWords
    )internal override{
<span class="cstat-no" title="statement not covered" >      uint256 indexOfwinner=randomWords[0]% players.length;</span>
<span class="cstat-no" title="statement not covered" >      address payable recentWinner=players[indexOfwinner];</span>
      s_recentWinner=recentWinner;
      stateLottery=LotteryState.Open;
      players=new address payable[](0);
      s_setInterval=block.timestamp; 
<span class="cstat-no" title="statement not covered" >      (bool success,)=recentWinner.call{value:address(this).balance}("");</span>
<span class="cstat-no" title="statement not covered" >      if(!success){</span>
       revert tranferFailed();
        }
<span class="cstat-no" title="statement not covered" >        emit WinnerPicked(recentWinner);</span>
&nbsp;
    }
&nbsp;
    function getEntered()public payable{
        if(msg.value&lt;i_entryFee){
            revert LowAmount();
            }
        players.push(payable(msg.sender));
        emit participantEntered(msg.sender);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getRecentWinner()public view returns(address){</span>
<span class="cstat-no" title="statement not covered" >        return s_recentWinner;</span>
    }
&nbsp;
&nbsp;
    function getEntryFee()public view returns(uint){
        return i_entryFee;
    }
&nbsp;
&nbsp;
    function getPlayer(uint index)public view returns(address){
        return players[index];
    }
&nbsp;
&nbsp;
//   for performing tasks on chain keepers
<span class="fstat-no" title="function not covered" >     function checkUpkeep(bytes memory)</span>
     public
     view 
     override
     returns(bool upKeepNeeded,bytes memory  /*performData*/){
<span class="cstat-no" title="statement not covered" >       bool isOpen=(LotteryState.Open==stateLottery);</span>
<span class="cstat-no" title="statement not covered" >       bool timePassed=((block.timestamp-lastTimeStamp)&gt;s_setInterval);</span>
<span class="cstat-no" title="statement not covered" >       bool hasPlayers=(players.length&gt;0);</span>
<span class="cstat-no" title="statement not covered" >       bool hasBalance=address(this).balance&gt;0;</span>
       upKeepNeeded=(isOpen &amp;&amp; timePassed &amp;&amp; hasBalance &amp;&amp; hasPlayers);
     }
 
&nbsp;
     function getLotteryState()public view returns(LotteryState){
        return stateLottery;
     }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >     function getNumWords()public view returns(uint){</span>
<span class="cstat-no" title="statement not covered" >        return NUM_Words;</span>
     }
    
<span class="fstat-no" title="function not covered" >    function getNumberOfPlayer()public view returns(uint){</span>
<span class="cstat-no" title="statement not covered" >        return players.length;</span>
    }
    
    function getCurrentInterval()public view returns(uint){
        return s_setInterval;
    }
<span class="fstat-no" title="function not covered" >    function getRequestConfirmation()public view returns(uint){</span>
<span class="cstat-no" title="statement not covered" >        return requestConfirmations;</span>
    }
&nbsp;
&nbsp;
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Oct 22 2023 00:57:05 GMT+0500 (Pakistan Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
